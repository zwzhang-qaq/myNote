[toc]

# 嵌入式系统期末复习

期末考试试卷分值为 选择题（20分），简答题（20分），程序分析题（30分），程序设计题（30分）。

其中 【程序分析题】 和 【程序设计题】重点为复习重点为第三章和第四章，按过程给分！！！ 

【程序分析题】 大家除了把最后计算结果，把程序中主要命令的分析过程写到答题册上；

【程序设计题】把设计的程序（万一完整的写不出来的话，把你能写出来的指令，或者程序片段）写到答题册上，总之，不要给我空着！！！（空着只能是0分）

## 第一章 嵌入式系统概述

### 嵌入式系统定义：

- 从技术的角度定义：以应用为中心、以计算机技术为基础、软件硬件可裁剪、对功能、可靠性、成本、体积、功耗严格要求的专用计算机系统

- 从系统的角度定义：嵌入式系统是设计完成复杂功能的硬件和软件，并使其紧密耦合在一起的计算机系统

### 为什么把嵌入式系统集成到大的系统里面？

- 更高的性能
- 更多的功能
- 更低的功耗
- 更高的可靠

### 嵌入式系统的**特点**：

- 1.嵌入式系统中运行的**任务是专用而确定**的；
- 2.桌面通用系统需要支持**大量的、需求多样**的应用程序；
- 3.**实时性**；
- 4.**高可靠性**；
- 5.**功耗约束**；
- 6.嵌入式系统比桌面通用系统**可用资源少**得多；
- 7.嵌入式系统的开发需要**专用工具和特殊方法**。

### 嵌入式系统结构：

- 嵌入式系统一般由**嵌入式微处理器**、**外围硬件设备**、**嵌入式操作系统（可选）**，以及**用户的软件系统**等四个部分组成。

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419185841611.png" alt="image-20230419185841611" style="zoom:80%;" />

### 处理器结构

组成：

- 控制单元：取指
- 执行单元：数据运算

结构：

- 哈佛结构：数据和指令各有各的总线。执行效率高，设计复杂度高
- 冯诺依曼结构：存储程序原理，代码也是数据。简化了结构，降低了复杂性，总线的吞吐量成为性能提升的瓶颈

### CISC vs RISC

- CISC适用于通用计算机，RISC适用于嵌入式系统
- **RISC中，CPU与memory之间不能直接进行数据传输**，必须通过 load/store 指令把数据从内存搬到register，CPU再操作register里面的数据

### 嵌入式微处理器—ARM

- **ARM：Advanced RISC Machines**，可以认为是一个公司的名字，一类微处理器的统称，还可以认为是一种技术的名字
- o1991年ARM公司成立于英国剑桥，主要出售芯片设计技术的**授权(IP)**
- 已成为移动通信、手持设备、多媒体数字消费嵌入式解决方案的RISC标准，占据了32位RISC MCU 80%以上的市场份额。
- **ARM处理器三大特点**：
  - 1.体积小、低功耗、低成本、高性能
  - 2.拥有16/32位双指令集
  - 3.全球的合作伙伴众多

### 嵌入式微处理器—MIPS

- **MIPS：Microprocessor without Interlocked Piped Stages**的缩写，无内部互锁流水级的微处理器，是一种处理器内核标准
- 基于RISC架构，由MIPS技术公司开发的
- MIPS应用领域覆盖游戏机、路由器、掌上电脑等各个方面。

### 嵌入式微处理器—PowerPC

- **PowerPC:Performance Optimization With Enhanced RISC – Performance Computing**
- 基于RISC架构，由IBM、Apple和Motorola共同开发

### 嵌入式处理器：

- 嵌入式微处理器（MPU）
- 嵌入式微处理器（MCU）
- 嵌入式DSP处理器（DSP）
- 嵌入式片上系统（System On Chip）







## 第二章 ARM体系结构

### IP核分类

I**P（Intellectual Property）知识产权**

**硅知识产权核是预先设计好的电路功能模块，**根据IP核的提供方式，分为软核（Soft IP Core），固核（Firm IP Core）硬核（Hard IP Core）

- **软核**：综合之前的RTL代码，只经过功能仿真，需要经过综合以及布局布线才能使用
- **固核**：完成软核的设计外，及门级电路综合和时序仿真等设计环节，以门级电路网表的形式提供给用户
- **硬核**：基于物理描述并经过工艺验证，提供给用户的形式是电路物理结构、掩模版图和全套工艺文件

### ARM处理器系列：

**版本号**：

- 从V7开始系列号不再以数字命名，统一用 cortex 命名

- V8首款支持64位指令集的处理器架构，两个执行状态：AArch64，AArch32

- Cortex系列基于V7架构

  Cortex-A—面向性能密集型系统的应用处理器内核**（高性能）**

  Cortex-R—面向实时应用的高性能内核**（实时）**

  Cortex-M—面向各类嵌入式应用的微控制器内核**（面向用户）**

**序列号**：

- ARM7:三级流水，冯诺伊曼结构。

- ARM8:五级流水，哈佛结构。

**微处理器组成**：控制部件、算术逻辑部件、寄存器组

### 命名规则

从V7之后，即使不加TDMI也默认有这个功能

T：支持Thumb指令集

D：支持片上调试Debug

M：快速乘法器 Multiplier

I：Embedded ICE

E：DSP指令

J：java加速器

S：可综合

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419213354289.png" alt="image-20230419213354289" style="zoom: 50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419213525083.png" alt="image-20230419213525083" style="zoom: 67%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419213800060.png" alt="image-20230419213800060" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419213838075.png" alt="image-20230419213838075" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419213909193.png" alt="image-20230419213909193" style="zoom:50%;" />

### ARM微控制器的AMBA总线体系结构

**AMBA（Advanced Microcontroller Bus Architecture）是ARM公司公布的总线标准，AMBA 2.0规范定义了三种总线**：

- **AHB总线**（Advanced High-performance Bus）：用于连接高性能系统模块。它支持**突发数据传输**方式以及单个数据传输方式，所有时许参考同一个时钟沿。

- **ASB总线**（Advanced System Bus）：用于连接高性能系统模块，在不必要使用AHB的高速特性的场合，它支持突发数据传输方式。

- **APB总线**（Advanced Peripheral Bus）：是一个简单连接口支持低性能的外围接口。

AMBA 3.0 引入**AXI**总线（Advanced extensible Interface）

### 流水线

- **三级流水：取指、译码、执行**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215004637.png" alt="image-20230419215004637" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215033439.png" alt="image-20230419215033439" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215426432.png" alt="image-20230419215426432" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215454911.png" alt="image-20230419215454911" style="zoom:50%;" />

- **五级流水：取指、译码、执行、访存、回写。**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215553599.png" alt="image-20230419215553599" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419215620044.png" alt="image-20230419215620044" style="zoom:50%;" />

五级流水的**存储器访问**和**寄存器写操作**分别由单独的流水线处理，解决了三级流水LDR/STR指令执行阶段的延迟。 如果不是对存储器访问，本级流水线为一个空的时钟周期。



### CISC & RISC 体系结构

**CISC 缺点：**

- 随着计算机技术的发展而不断引入新的复杂指令集，为支持这些新增的指令，计算机的体系结构会越来越复杂。
- 在CISC指令集的各种指令中，其使用频率却相差悬殊。

**RISC体系结构：**

- 指令系统相对**简单**，只要求硬件执行**很有限**且**最常用**的那部分指令，大部分复杂的操作则使用成熟的编译技术，由**简单指令合成**。

- RICS不是简单的减少指令，而是
  - 1.使计算机结构更加简单；
  - 2.合理地提高运算速度

- RISC特点：
  - 1.编码长度一致，单拍完成，便于流水操作
  - 2.大量寄存器，只有store、load可以访问存储器
  - 3.指令规整、对称、简单。简单寻址，基本寻址方式2～3种

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230419220924140.png" alt="image-20230419220924140" style="zoom:67%;" />





### ARM指令集：

- **固定的32位指令（字对齐）**，Load/Store RISC 特征

- 5大类指令：

  - 1.数据处理指令：**MOV**、AND、SUB、ADD

  - 2.加载和存储指令：**LDR、STR**、LDM、STM

  - 3.分支指令：B、**BX**

  - 4.协处理器指令：LDC、STC

  - 5.杂项指令：SWI、MRS、MSR

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420123953716.png" alt="image-20230420123953716" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420124010405.png" alt="image-20230420124010405" style="zoom:50%;" />

### Thumb指令集

- 是32位ARM指令集的功能子集，按照16位指令重新编码，**固定的16位指令（半字对齐）**
- **4大类指令：**
  - 1.分支指令
  - 2.数据处理指令
  - 3.寄存器加载和存储指令
  - 4.异常产生指令

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420130344369.png" alt="image-20230420130344369" style="zoom:50%;" />

ARM指令和Thumb指令并存可以增加系统的灵活性

ARM 指令在32位的存储下性能较高;

Thumb指令具有较高的指令密度，可以有效降低存储器功耗，并且在16位的存储器下具有较好的性能。

### 数据类型：

- **字节（byte）**：在ARM体系结构和8位/16位处理器体系结构中，字节的长度均为**8位**
- **字（word）**：**在ARM体系中，字的长度为32位**，必须分配为占用4个字节；而在**8位/16位处理器体系结构中，字的长度一般为16位**
- **半字（half-word）**：在ARM体系结构中，半字的长度为**16位**，必须分配为占用两个字节。与8位/16位处理器体系结构中字的长度一致

### ARM状态和Thumb状态：

**ARM状态:**

- 处理器执行的32位的ARM指令（字对齐），伪指令**CODE32**声明

- ARM指令必须在ARM状态下执行

**Thumb状态**：

- 处理器执行的16位的Thumb指令（半字对齐），伪指令**CODE16**声明

- Thumb在性能和代码大小之间提供了出色的折中
- 正在执行Thumb指令集的处理器工作在Thumb状态下
- 正在执行ARM指令集的处理器工作在ARM状态下
- 带状态切换的分支指令BX

**状态切换：**

- **进入Thumb状态**：
  - **操作数寄存器状态位[0]为1时，执行BX（带状态的分支切换指令），进入Thumb状态**
  - **如果处理器在Thumb状态进入异常，则当异常处理返回时，自动切换到Thumb状态**
- **进入ARM状态**：
  - **操作数寄存器状态位[0]为0时，执行BX（带状态的分支切换指令），进入ARM状态**
  - **处理器进入异常处理时，进入ARM状态，从异常向量地址处开始执行**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420121439216.png" alt="image-20230420121439216" style="zoom: 33%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420121517993.png" alt="image-20230420121517993" style="zoom: 33%;" />



### ARM体系结构的存储器格式：

- **大端格式（Big Endian）**：字数据的高字节存储在低地址中，而字数据的低字节则存放在高地址中
- **小端格式（Little Endian）**：低地址中存放的是字数据的低字节，高地址存放的是字数据的高字节

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420134024824.png" alt="image-20230420134024824" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420134100228.png" alt="image-20230420134100228" style="zoom: 33%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420134436604.png" alt="image-20230420134436604" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420134507961.png" alt="image-20230420134507961" style="zoom:50%;" />



### ARM微处理器模式

**7种处理器模式：**

- 用户模式
- 系统模式
- 快中断模式
- 中断模式
- 管理模式
- 中止模式
- 未定义模式

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420135938374.png" alt="image-20230420135938374" style="zoom:50%;" />

**特权模式：除用户模式外，其它模式均为特权模式。**

- ARM内部寄存器和一些片内外设在硬件设计上只允许（或者可选为只允许）特权模式下访问。
- 特权模式可以**自由地切换处理器模式**，而用户模式不能直接切换到别的模式。
- 特权模式可以**自由地访问系统资源和改变模式**

**异常模式：除用户模式、系统模式外，其它模式均为异常模式。**

- 除了可以通过程序切换进入外，也可以由特定的异常进入
- 当特定的异常出现时，处理器进入相应的模式
- 每种异常模式都有一些独立的寄存器，以避免异常退出时用户模式的状态不可靠

**用户模式和系统模式使用完全相同的寄存器组**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420141205041.png" alt="image-20230420141205041" style="zoom:50%;" />

ARM处理器的运行模式可以通过**软件改变（特权模式）**，也可以通过**外部中断**或**异常处理**改变。

大多数的应用程序运行在用户模式下，当处理器运行在用户模式下时，某些被保护的系统资源是不能被访问的，也不能改变模式，除非异常发生。



### 寄存器组织

- ARM处理器有37（31 + 6）个物理寄存器，**31个通用寄存器（32位）和6个状态寄存器**
- 寄存器被安排成部分重叠的组。每种处理器模式都有不同的寄存器组
- 分组的寄存器在异常处理和特权操作时，可得到快速的上下文切换

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420142230065.png" alt="image-20230420142230065" style="zoom: 25%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420142318185.png" alt="image-20230420142318185" style="zoom:25%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420142630850.png" alt="image-20230420142630850" style="zoom:25%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420142719963.png" alt="image-20230420142719963" style="zoom:25%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420142916840.png" alt="image-20230420142916840" style="zoom:25%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420143004475.png" alt="image-20230420143004475" style="zoom:25%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420143048716.png" alt="image-20230420143048716" style="zoom:25%;" />

#### 通用寄存器和程序计数器：

- 在汇编语言中寄存器R0～R13为保存数据或地址值的通用寄存器。它们是完全通用的寄存器，不会被体系结构作为特殊用途，并且可用于任何使用通用寄存器的指令。
- 其中R0～R7为未分组的寄存器，也就是说对于任何处理器模式，这些寄存器都对应于相同的32位物理寄存器。
- 寄存器R8～R14为分组寄存器。它们所对应的物理寄存器取决于当前的处理器模式，几乎所有允许使用通用寄存器的指令都允许使用分组寄存器
- 寄存器R8～R12有两个分组的物理寄存器。一个用于除FIQ模式之外的所有寄存器模式，另一个用于FIQ模式。这样在发生FIQ中断后，可以加速FIQ的处理速度。
- 寄存器R13、R14分别有6个分组的物理寄存器。一个用于用户和系统模式，其余5个分别用于5种异常模式。

- **重要寄存器：**

  - **R13：堆栈指针寄存器（SP）**

    - 在ARM指令集当中，没有以特殊方式使用R13的指令或其它功能，只是习惯上都这样使用。

         但是在Thumb指令集中存在使用R13的指令。

  - **R14：链接寄存器（LR）**

    结构上的两个特殊功能：

    - 1.在每种模式下，模式自身的R14版本用于**保存子程序返回地址**

    - 2.当发生异常时，该模式下的R14被设置成该异常模式**将要返回的地址**

      <img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420150649745.png" alt="image-20230420150649745" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420150723977.png" alt="image-20230420150723977" style="zoom: 33%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420150943579.png" alt="image-20230420150943579" style="zoom:50%;" />

      详细过程见第二章ppt p99

      

  - **R15：程序计数器（PC）：指向正在取指的地址**

    - 可以认为它是一个通用寄存器，但是对于它的使用有许多与指令相关的限制或特殊情况。
    - 如果R15使用的方式超出了这些限制，那么结果将是不可预测的。

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153541743.png" alt="image-20230420153541743" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153620657.png" alt="image-20230420153620657" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153710888.png" alt="image-20230420153710888" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153744287.png" alt="image-20230420153744287" style="zoom: 33%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153836909.png" alt="image-20230420153836909" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420153900847.png" alt="image-20230420153900847" style="zoom:50%;" />



### 状态寄存器

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420155854665.png" alt="image-20230420155854665" style="zoom:67%;" />

**CPSR程序状态寄存器：**

- CPSR反映了当前处理器的状态：

  - 4个条件码标志；
  - 2个中断控制位；
  - 5个对当前处理器模式进行编码的位；
  - 1个指示当前执行指令的工作状态位；
  - 保留位

  <img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420163941947.png" alt="image-20230420163941947" style="zoom:50%;" />

**条件代码标志：**

- 大多数“数值处理指令”可以选择是否影响条件代码标志位（指令带“s”后缀），但有些指令执行总是影响条件代码标志位；
- 所有ARM指令都可以按照条件来执行，而Thumb指令中只有分支指令可按条件执行
- “C”标志位注意：对于移位操作指令，C为从最高位最后移出的值，其他指令C通常不变。

**保留位：**

- 保留位将被保留将来使用。
- 为了提高程序的可移植性，当改变CPSR标志和控制位时，不要改变这些保留位；确保程序的运行不受保留位的影响，因为将来的处理器可能会将这些位置设为1或0

**控制位：**

- 最低8位为控制位，当发生异常时，这些位被硬件改变。
- 当处理器位于一个特权模式时，可用软件操作这些位。

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420165346814.png" alt="image-20230420165346814" style="zoom:50%;" />



**SPSR程序状态保存寄存器：**

- 备份程序状态字，保存异常事件**发生之前**的CPSR

- 在异常模式下，SPSR可以被访问
- 每种异常都有自己的SPSR，在因为异常事件而进入异常时它保存CPSR的当前值，异常退出时可通过它恢复CPSR。
- CPSR和SPSR通过特殊指令进行访问。

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420165427511.png" alt="image-20230420165427511" style="zoom:50%;" />



**Thumb状态下的寄存器：**

- Thumb状态下的寄存器集是ARM状态集的子集，程序员**可以直接访问的寄存器**为：
  - 8个通用寄存器R0~R7
  - 程序计数器PC
  - 堆栈指针SP
  - 链接寄存器LR
  - 有条件访问程序状态寄存器CPSR

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420161211642.png" alt="image-20230420161211642" style="zoom:50%;" />

- **Thumb状态下的通用寄存器R0~R7：**
  - 对于任何处理器模式，它们中的每一个都对应于相同的32位物理寄存器。它们是完全通用的寄存器，不会被体系结构作为特殊的用途，并且可用于任何使用通用寄存器的指令。
- **Thumb状态下的堆栈指针寄存器SP：**
  - 堆栈指针SP对应ARM状态的寄存器R13
  - 每个异常模式都有其自身的SP分组版本，SP通常指向各异常模式所专用的堆栈。
  - 注意：在发生异常时，处理器自动进入ARM状态。
- **Thumb状态下的链接寄存器LR（R14）：**
  - 链接寄存器LR对应ARM状态寄存器R14
  - 在结构上有两个特殊功能:子程序返回地址、异常返回地址。
  - 注意：在发生异常时，处理器自动进入ARM状态。

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420162423460.png" alt="image-20230420162423460" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420163208522.png" alt="image-20230420163208522" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420163257276.png" alt="image-20230420163257276" style="zoom:50%;" />

### 异常

- **只要正常的程序流被暂时中止，处理器就进入异常模式。**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420165638490.png" alt="image-20230420165638490" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170521440.png" alt="image-20230420170521440" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170502243.png" alt="image-20230420170502243" style="zoom: 33%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170542536.png" alt="image-20230420170542536" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170811261.png" alt="image-20230420170811261" style="zoom: 33%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170849369.png" alt="image-20230420170849369" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420170946488.png" alt="image-20230420170946488" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420171014055.png" alt="image-20230420171014055" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420171049821.png" alt="image-20230420171049821" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420171123374.png" alt="image-20230420171123374" style="zoom:50%;" />

详细过程见第二章ppt p132、p133



<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420172214462.png" alt="image-20230420172214462" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181317857.png" alt="image-20230420181317857" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181338604.png" alt="image-20230420181338604" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181404873.png" alt="image-20230420181404873" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181434814.png" alt="image-20230420181434814" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181512904.png" alt="image-20230420181512904" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181622304.png" alt="image-20230420181622304" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181655609.png" alt="image-20230420181655609" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181729569.png" alt="image-20230420181729569" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181749306.png" alt="image-20230420181749306" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181825170.png" alt="image-20230420181825170" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181848520.png" alt="image-20230420181848520" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420181938261.png" alt="image-20230420181938261" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420182016945.png" alt="image-20230420182016945" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420182045725.png" alt="image-20230420182045725" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420182119235.png" alt="image-20230420182119235" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420182142290.png" alt="image-20230420182142290" style="zoom: 33%;" />















## 第三章 ARM指令集

### ARM指令概述：

- ARM微处理器是基于精简指令计算机（**RISC**）的原理设计的，指令集和相关译码机制比较简单；
- ARM7系列微处理器具有**32位的ARM**指令集和**16位的Thumb**指令集；
- ARM指令集效率高，但是代码密度低，占用较大的内存空间
- Thumb指令集属于ARM指令集的子集，具有较好的代码密度，功能简单
- 所有的ARM指令都是可以**有条件执行**
- 而**Thumb指令集只有一条指令（B）具有条件执行的功能**
- ARM指令和Thumb指令可以**相互调用**，两者之间的状态**切换所用的开销几乎为0**

### ARM处理器寻址方式

**寻址方式：处理器根据指令中给出的地址信息来寻找被操作对象的物理地址的方式。**

ARM处理器具有9种基本寻址方式：

- 1.寄存器寻址
- 2.立即寻址
- 3.寄存器移位寻址
- 4.寄存器间接寻址
- 5.基址寻址
- 6.多寄存器寻址
- 7.堆栈寻址
- 8.块拷贝寻址
- 9.相对寻址

#### 1.寄存器寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420183916773.png" alt="image-20230420183916773" style="zoom: 33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\1.寄存器寻址.gif" alt="1.寄存器寻址" style="zoom: 50%;" />

#### 2.立即寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185006159.png" alt="image-20230420185006159" style="zoom: 33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\2.立即寻址.gif" alt="2.立即寻址" style="zoom:50%;" />

#### 3.寄存器移位寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185158347.png" alt="image-20230420185158347" style="zoom:33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\3.寄存器移位寻址.gif" alt="3.寄存器移位寻址" style="zoom: 50%;" />



#### 4.寄存器间接寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185509468.png" alt="image-20230420185509468" style="zoom:33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\4.寄存器间接寻址.gif" alt="4.寄存器间接寻址" style="zoom:50%;" />



#### 5.基址寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185601768.png" alt="image-20230420185601768" style="zoom:33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\5.基址寻址.gif" alt="5.基址寻址" style="zoom:50%;" />



#### 6.多寄存器寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185739182.png" alt="image-20230420185739182" style="zoom:33%;" /><img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\6.多寄存器寻址.gif" alt="6.多寄存器寻址" style="zoom:50%;" />



#### 7.堆栈寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420185803229.png" alt="image-20230420185803229" style="zoom:33%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420190441887.png" alt="image-20230420190441887" style="zoom:50%;" />

<img src="D:\CourseFiles\嵌入式系统\ARM处理器寻址GIF\7.堆栈寻址.gif" alt="7.堆栈寻址" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420190605086.png" alt="image-20230420190605086" style="zoom:50%;" />



#### 8.块拷贝寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420190839448.png" alt="image-20230420190839448" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420210038570.png" alt="image-20230420210038570" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420210124117.png" alt="image-20230420210124117" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420210158738.png" alt="image-20230420210158738" style="zoom:50%;" />



#### 9.相对寻址

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420190911671.png" alt="image-20230420190911671" style="zoom:50%;" />





### ARM指令集介绍

#### 1.指令格式

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420191611590.png" alt="image-20230420191611590" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420191652233.png" alt="image-20230420191652233" style="zoom:50%;" />

- 指令格式：第2个操作数

  operand2有如下形式：

  - #immed_8r  ——常数表达式
  - Rm ——寄存器方式
  - Rm，shift ——寄存器移位方式

  <img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420213746276.png" alt="image-20230420213746276" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420213823247.png" alt="image-20230420213823247" style="zoom:50%;" />

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420213858577.png" alt="image-20230420213858577" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420214330264.png" alt="image-20230420214330264" style="zoom:33%;" />



#### 2.条件码

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420215715882.png" alt="image-20230420215715882" style="zoom:50%;" /><img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420215801717.png" alt="image-20230420215801717" style="zoom:50%;" />

#### 3.ARM存储器访问指令

- ARM处理器是典型的RISC处理器，对存储器的访问**只能使用加载和存储指令实现**。
- 冯·诺依曼存储结构，程序空间、RAM空间及I/O映射空间统一编址，除对RAM操作以外，**对外围IO、程序数据的访问均要通过加载/存储指令进行**
- 存储器访问指令分为**单寄存器操作指令**和**多寄存器操作指令**

**单寄存器加载：**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420220438628.png" alt="image-20230420220438628" style="zoom:50%;" />

**单寄存器存储：**

<img src="C:\Users\zzw\AppData\Roaming\Typora\typora-user-images\image-20230420220543070.png" alt="image-20230420220543070" style="zoom:50%;" />







#### 4.ARM数据处理指令



#### 5.乘法指令

#### 6.ARM分支指令

#### 7.协处理器指令

#### 8.杂项指令

#### 9.伪指令

